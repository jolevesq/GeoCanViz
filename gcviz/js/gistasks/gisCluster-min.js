(function(){define(["cluster","gcviz-gisgeo","esri/request","esri/symbols/SimpleMarkerSymbol","esri/renderers/ClassBreaksRenderer","esri/renderers/jsonUtils","esri/geometry/Point","esri/SpatialReference"],function(k,l,e,c,b,a,h,j){var g,d,i,f={};d=function(q,p){var o=p.url,n=o.indexOf("MapServer/"),m=o.substring(0,n)+"MapServer/layers/"+o.substring(n+17,o.length-1);e({url:m,content:{f:"json"},handleAs:"json",callbackParamName:"callback",load:function(r){g(q,p,r.layers[0].drawingInfo.renderer)},error:function(r){console.log("renderer info error: "+r)}})};g=function(p,o,n){var m;m=o.url+"/query?where=OBJECTID+>+0&outFields=AGE&dirty="+(new Date()).getTime();e({url:m,content:{f:"json"},handleAs:"json",callbackParamName:"callback",load:function(s){var u,x,y,w=[],v=p.spatialReference.wkid,r=s.spatialReference.wkid,q=s.features,t=q.length;while(t--){u=q[t];x=u.geometry;y=new h(x.x,x.y,new j({wkid:r}));y.attributes=u.attributes,w.push(y)}f={map:p,renderJSON:n,layerInfo:o};if(v!==r){l.projectPoints(w,v,i)}else{i(w)}},error:function(q){console.log("cluster info error: "+q)}})};i=function(p){var m,r=f.map,q=f.layerInfo,n=q.cluster,o=a.fromJson(f.renderJSON),s=q.scale;if(n.symbol===1){o=null}m=new k({data:p,renderer:o,distance:n.distance,id:q.id,label:n.label,maxSizeProp:n.maxSizeProp,maxDataProp:n.maxDataProp,spatialReference:r.spatialReference});r.addLayer(m);f={};m.minScale=s.min;m.maxScale=s.max;require(["gcviz-gismap"],function(t){t.setScaleInfo(r,q)});r.reorderLayer(r.getLayer("gcviz-symbol"),1000)};return{startCluster:d}})}());
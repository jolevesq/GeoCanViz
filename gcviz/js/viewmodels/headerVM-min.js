(function(){define(["jquery-private","knockout","media","gcviz-gisprint","gcviz-i18n","gcviz-ko","gcviz-func","gcviz-gismap","gcviz-vm-help"],function(f,l,b,g,m,i,k,h,a){var e,d,j,c;e=function(p,n,o){var q=function(v,F,u){var G=this,z=u.about,A=locationPath+"gcviz/print/toporamaPrint-"+window.langext+".html",B=locationPath+"gcviz/images/helpBubble.png",y=f("#section"+F),s=f("#"+F),E=f("#"+F+"_holder"),w=f("#"+F+"_holder_root"),H=v.find(".gcviz-head-about"),r=v.find("#gcviz-menu"+F),D=v.find(".gcviz-head-pop"),C=f("#ovmapcont"+F),t=k.getElemValueVM(F,["map","map"],"js"),x=36;G.mapid=F;G.imgHelpBubble=B;G.xheightToolsOuter=l.observable("max-height:100px!important");G.xheightToolsInner=l.observable("max-height:100px!important");G.tpHelp=m.getDict("%header-tphelp");G.tpPrint=m.getDict("%header-tpprint");G.tpInset=m.getDict("%header-tpinset");G.tpAbout=m.getDict("%header-tpabout");G.tpFullScreen=m.getDict("%header-tpfullscreen");G.lblMenu=m.getDict("%header-tools");G.legendTitle=m.getDict("%toolbarlegend-name");G.legendAlt=m.getDict("%toolbarlegend-alt");G.drawTitle=m.getDict("%toolbardraw-name");G.drawAlt=m.getDict("%toolbardraw-alt");G.navTitle=m.getDict("%toolbarnav-name");G.navAlt=m.getDict("%toolbarnav-alt");G.dataTitle=m.getDict("%toolbardata-name");G.dataAlt=m.getDict("%toolbardata-alt");G.lblAboutTitle=m.getDict("%header-tpabout");G.isAboutDialogOpen=l.observable(false);G.aboutType=z.type;if(G.aboutType===1){G.aboutInfo1=z.value}else{if(G.aboutType===2){G.aboutInfo1=m.getDict("%header-aboutread");G.aboutInfo2=m.getDict("%linkopens");G.aboutURL=z.value;G.aboutURLText=m.getDict("%header-abouttitle")}}G.printInfo={url:m.getDict("%header-printurl"),copyright:m.getDict("%header-printcopyright"),template:A};G.isFullscreen=l.observable(false);G.isInsetVisible=l.observable(true);G.insetState=true;G.fullscreenState=0;G.opencloseToolsState=0;G.toolsInit=u.tools;G.init=function(){var I=f("#gcviz-menu-cont"+F);G.heightSection=parseInt(y.css("height"),10);G.heightMap=parseInt(E.css("height"),10);G.widthSection=parseInt(y.css("width"),10);G.widthMap=parseInt(E.css("width"),10);G.headerHeight=parseInt(v.css("height"),10);setTimeout(function(){G.adjustContainerHeight()},500);I.on("accordioncreate",function(L){var M,K=L.target.getElementsByTagName("div"),J=K.length;while(J--){M=K[J].getAttribute("gcviz-exp");if(M==="true"){I.accordion("option","active",J)}}if(!G.toolsInit.expand){setTimeout(function(){r.accordion("option","active",false)},0)}I.off("accordioncreate")});return{controlsDescendantBindings:true}};G.showBubble=function(J,I,K,L){return a.toggleHelpBubble(J,L)};G.fullscreenClick=function(){k.debounceClick(function(){if(G.fullscreenState===0){f("html").css("overflow","hidden");G.requestFullScreen()}else{f("html").css("overflow","auto");G.cancelFullScreen()}f(".gcviz-tooltip").remove()},1000)};G.printClick=function(){d(t,G.printInfo.template)};G.insetClick=function(){k.debounceClick(function(){var I;G.insetState=!G.insetState;G.isInsetVisible(G.insetState);if(G.insetState){I=y.find("[tabindex = 0]");G.first=I[0];G.last=I[I.length-1]}else{I=y.find("[tabindex = 0]").not(".gcviz-inset-button");G.first=I[0];G.last=I[I.length-1]}},1000)};G.toolsClick=function(){var I=r.accordion("option","active");if(I===0){r.accordion("option","active",false)}else{r.accordion("option","active",0)}};G.helpClick=function(){a.toggleHelp()};G.aboutClick=function(){G.isAboutDialogOpen(true)};G.dialogAboutOk=function(){G.isAboutDialogOpen(false);H.focus()};G.cancelFullScreen=function(){var K=G.heightSection,I=G.widthSection,L=G.heightMap,J=G.widthMap;k.setStyle(s[0],{width:I+"px",height:(K-x)+"px"});k.setStyle(E[0],{width:J+"px",height:L+"px"});k.setStyle(w[0],{width:J+"px",height:L+"px"});s.removeClass("gcviz-sectionfs");G.isFullscreen(false);G.fullscreenState=0;h.manageScreenState(t,500,false);setTimeout(function(){G.adjustContainerHeight();D.focus()},500);s.off("keydown.fs");k.setStyle(C[0],{bottom:"40px"})};G.requestFullScreen=function(){var L=k.getFullscreenParam(),J=L.width,K=L.height,M=s.find("[tabindex = 0]"),I=(K-(2*G.headerHeight));k.setStyle(s[0],{width:J+"px",height:K+"px"});k.setStyle(E[0],{width:(J-15)+"px",height:I+"px"});k.setStyle(w[0],{width:(J-15)+"px",height:I+"px"});s.addClass("gcviz-sectionfs");G.isFullscreen(true);G.fullscreenState=1;h.manageScreenState(t,1000,true);setTimeout(function(){G.adjustContainerHeight();v.find(".gcviz-head-reg").focus()},500);G.first=M[0];G.last=M[M.length-1];s.on("keydown.fs",function(N){G.manageTabbingOrder(N)});k.setStyle(C[0],{bottom:"40px"})};G.adjustContainerHeight=function(){var I=parseInt(t.height,10)-5;G.xheightToolsOuter("max-height:"+I+"px!important");G.xheightToolsInner("max-height:"+(I-x)+"px!important")};G.manageTabbingOrder=function(J){var L=J.which,I=J.shiftKey,O=J.target.className,M=G.first.className,K=G.last.className,P=G.first,N=G.last;if(L===9&&!I){if(O===K){setTimeout(function(){P.focus()},0)}}else{if(L===9&&I){if(O===M){setTimeout(function(){N.focus()},0);if(window.browser==="Chrome"){N.focus()}}}}};G.init()};c=new q(p,n,o);l.applyBindings(c,p[0]);return c};d=function(F,G){var y,x,p,r,q,D,B,A,z,E={},o=F.vIdName,w=f("#"+o+"_holder"),n=f("#arrow"+o),C=f("#scalebar"+o),s=f(".gcviz-map-zm"),u=f(".dijitSlider"),t=w.css("height"),v=w.css("width");E.point=h.getMapCenter(F);k.setStyle(w[0],{width:"10in",height:"5.25in"});k.setStyle(w.find("#"+o+"_holder_root")[0],{width:"10in",height:"5.25in"});E.interval=1500;h.resizeCenterMap(F,E);window.open(G);s.addClass("gcviz-hidden");u.addClass("gcviz-hidden");x=j(n);y=n.attr("style");B=new RegExp(x-1,"g"),A=new RegExp(x,"g"),z=new RegExp(x+1,"g"),r=y.indexOf(".");q=y.indexOf("deg");if(r!==-1){p=y.substring(r,q);D=new RegExp(p,"g");y=y.replace(D,"")}y=y.replace(B,x-90);y=y.replace(A,x-90);y=y.replace(z,x-90);setTimeout(function(){localStorage.setItem("gcvizPrintNode",w[0].outerHTML);localStorage.setItem("gcvizArrowNode",'<img src="../images/printNorthArrow.png" style="'+y+'"></img>');localStorage.setItem("gcvizScalebarNode",C[0].outerHTML);localStorage.setItem("gcvizURL",window.location.href)},3500);setTimeout(function(){s.removeClass("gcviz-hidden");u.removeClass("gcviz-hidden");k.setStyle(w[0],{width:v,height:t});k.setStyle(w.find("#"+o+"_holder_root")[0],{width:v,height:t});h.resizeCenterMap(F,E)},7000)};j=function(r){var q,o,n,s,p=r.css("-webkit-transform")||r.css("-moz-transform")||r.css("-ms-transform")||r.css("-o-transform")||r.css("transform");if(p!=="none"){q=p.split("(")[1].split(")")[0].split(",");o=q[0];n=q[1];s=Math.round(Math.atan2(n,o)*(180/Math.PI))}else{s=0}if(s<0){s+=360}return s};return{initialize:e}})}).call(this);
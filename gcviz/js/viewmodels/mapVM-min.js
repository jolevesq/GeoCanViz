(function(){define(["jquery-private","knockout","gcviz-i18n","gcviz-func","gcviz-gismap","gcviz-gisgeo","gcviz-gisnav"],function(b,g,i,f,e,h,d){var c,a;c=function(k,j){var l=function(r,q){var m=this,n=r.mapframe,o=n.id,p=n.map,s;m.tpZoomFull=i.getDict("%map-tpzoomfull");m.mapid=o;m.mapfocus=g.observable();m.init=function(){var x,v,t,w=p.layers,u=p.bases,A=w.length,B=u.length,z=b("#"+o+"_holder"),y,C;f.setProgressBar(i.getDict("%mp-load"));e.setProxy(p.urlproxy);h.setGeomServ(p.urlgeomserv);m.mapholder=z;g.utils.registerEventHandler(m.mapholder,"focus",function(){m.mapfocus(true)});g.utils.registerEventHandler(m.mapholder,"blur",function(){m.mapfocus(false)});s=e.createMap(o+"_holder",p,q);u=u.reverse();while(B--){v=u[B];e.addLayer(s,v)}w=w.reverse();while(A--){x=w[A];e.addLayer(s,x)}y=b("#"+o+"_holder_root");C=b("#"+o+"_holder_container");z.addClass("gcviz-map");y.addClass("gcviz-root");C.addClass("gcviz-container");m.map=s;s.on("load",function(){var D;t=b(".esriPopupWrapper").find(".titlePane");t.prepend('<button class="gcviz-wcag-close ui-button ui-state-default ui-button-icon-only ui-dialog-titlebar-close" role="button" aria-disabled="false" title="close"><span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span></button>');D=t.find(".gcviz-wcag-close");D.on("click",function(){e.hideInfoWindow(m.map,"location")})});return{controlsDescendantBindings:true}};m.extentClick=function(){d.zoomFullExtent(s)};m.enterMouse=function(){m.mapholder.focus()};m.leaveMouse=function(){m.mapholder.blur()};m.applyKey=function(w,v){var x=m.map,u=false,t=false;if(m.mapfocus()){if(w===37){e.panLeft(x);u=true}else{if(w===38){e.panUp(x);u=true}else{if(w===39){e.panRight(x);u=true}else{if(w===40){e.panDown(x);u=true}else{if((w===187&&v)||(w===61&&v)){e.zoomIn(x);u=true}else{if((w===189&&v)||(w===173&&v)){e.zoomOut(x);u=true}else{if(w===61){u=true}else{if(w===27){if(typeof f.getElemValueVM(o,["draw"],"js")!=="undefined"){if(f.getElemValueVM(o,["draw","activeTool"],"ko")!==""){f.getElemValueVM(o,["draw","endDraw"],"js")();t=true}}if(typeof f.getElemValueVM(o,["nav"],"js")!=="undefined"){if(f.getElemValueVM(o,["nav","activeTool"],"ko")==="position"){f.getElemValueVM(o,["nav","endPosition"],"js")();t=true}}if(!t){f.getElemValueVM(o,["header","toolsClick"],"js")()}}}}}}}}}}return u};m.init()};a=new l(k,j);g.applyBindings(a,k[0]);return a};return{initialize:c}})}).call(this);
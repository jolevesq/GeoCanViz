(function(){define(["jquery-private","knockout","gcviz-func","dijit/form/HorizontalSlider","dijit/form/RadioButton","gcviz-i18n","jqueryui"],function(b,e,h,f,d,g){var a=[],c=[];e.bindingHandlers.tooltip={init:function(m,n,o,k){var l=e.utils.unwrapObservable(n()),j={},i=b(m);e.utils.extend(j,e.bindingHandlers.tooltip.options);e.utils.extend(j,l);i.attr("title",j.content);j.position.within="#"+k.mapid;i.tooltip(j);e.utils.domNodeDisposal.addDisposeCallback(m,function(){i.tooltip("destroy")})},options:{show:{effect:"fadeIn",delay:600},hide:{effect:"fadeOut",delay:100},position:{my:"right+30 top+5",collision:"fit"},tooltipClass:"gcviz-tooltip",trigger:"hover, focus"}};e.bindingHandlers.contextHelp={init:function(k,l){var j=l()||{},i=b(k);i.text(j.text);e.utils.registerEventHandler(i.parent(),"focus",function(m){m.currentTarget.getElementsByTagName("img")[0].tabIndex=0});e.utils.registerEventHandler(i.parent(),"blur",function(m){m.currentTarget.getElementsByTagName("img")[0].tabIndex=-1});i.append('<img id="'+j.id+'" tabindex="-1" data-bind="click: function() { showBubble(32, 0, 0, \''+j.link+"') }, clickBubble: false, enterkey: { func: 'showBubble', keyType: 'keydown', params: '"+j.link+'\' }" class="gcviz-help-bubble" src="'+j.img+'" alt="'+j.alt+'"></img>')}};e.bindingHandlers.wcag={init:function(l,n,o,j){var k,i=j.mapid,m=h.getElemValueVM(i,["wcag"],"js");k=function(){j.isWCAG(!j.isWCAG())};m.isWCAG.subscribe(k)}};e.bindingHandlers.fullscreen={init:function(k,n,o,j){var m,i=j.mapid,l=h.getElemValueVM(i,["header"],"js");m=function(p){if(p){j.enterFullscreen(l.widthSection,l.heightSection)}else{j.exitFullscreen()}};l.isFullscreen.subscribe(m)}};e.bindingHandlers.insetVisibility={init:function(k,m,n,j){var o,i=j.mapid,l=h.getElemValueVM(i,["header"],"js");l.isInsetVisible.subscribe(o);o=function(p){j.setVisibility(p)}}};e.bindingHandlers.enterkey={init:function(j,l,n,i){var k=l().func,m=l().keyType,o=l().params;e.utils.registerEventHandler(j,m,function(p){if(i[k](p.which,p.shiftKey,p.type,o)){p.stopImmediatePropagation();p.preventDefault();return false}return true})}};e.bindingHandlers.buttonBlur={init:function(i){a.push(i);e.utils.registerEventHandler(i,"mouseover",function(){var j=a.length;while(j--){b(a[j]).blur()}})}};e.bindingHandlers.panelBlur={init:function(i){c.push(i);e.utils.registerEventHandler(i,"mouseover",function(){var j=c.length;while(j--){b(c[j]).blur()}})}};e.bindingHandlers.HorizontalSliderDijit={init:function(j,o,n,p,k){var q=o(),i=p.id,m;function l(r,s){if(r.items.length>0){Object.keys(r.items).forEach(function(t){l(r.items[t],s,l)})}else{k.$root.changeServiceOpacity(r.id,s)}}if(q.enable){b(j).attr("Visible",q.visible);m=new f({name:"slider",minimum:q.extent[0],maximum:q.extent[1],intermediateChanges:true,value:q.value,showButtons:false}).placeAt(j);if(p.items.length===0){k.$root.changeServiceOpacity(i,q.value)}else{l(p,q.value,l)}dojo.addClass(m.domNode,"gcviz-leg-slider");m.on("Change",function(r){if(p.items.length===0){k.$root.changeServiceOpacity(i,r)}else{l(p,r,l)}})}}};e.bindingHandlers.legendItemList={init:function(l,m,n,k){var j=m(),i=b(l);if(k.items.length>0){i.children("div#childItems.gcviz-legendHolderDiv").toggle(j.expanded,function(o){o.stopPropagation()})}else{i.children(".gcviz-legendSymbolDiv").toggle(j.expanded);i.children("div#customImage.gcviz-legendHolderImgDiv").toggle(j.expanded)}if(k.displaychild.enable===false&&k.customimage.enable===false){i.css("background-image","none")}return false}};e.bindingHandlers.LegendRadioButtons={init:function(l,m,o,k,i){var j=m(),n;n=new d({name:j.group,value:j.value,checked:j.value}).placeAt(l);n.on("Change",function(p){i.$root.switchRadioButtonVisibility(i.$root.mymap,i.$data,p)})}};e.observableArray.fn.uniqueArray=function(){var i=this;e.computed(function(){var n,j,o,l=i(),m=[],k=l.length;for(j=0;j<k;j++){n=undefined;for(o=0;o<m.length;o++){if(l[j]===m[o]){n=true;break}}if(!n){m.push(l[j])}}return i(m)}).extend({notify:"always"});return i};e.bindingHandlers.uiDialog={init:function(j,l,k,o){var n,m=e.utils.unwrapObservable(l()),q={},p=b(j),i=e.bindingHandlers.uiDialog.options;b.extend(true,q,i);e.utils.extend(q,m);if(typeof q.ok!=="undefined"){q.buttons[0].click=q.ok}if(typeof q.cancel!=="undefined"){q.buttons[1].click=q.cancel}else{q.buttons.pop()}if(typeof q.close!=="undefined"){q.close=q.close}if(window.browser==="Firefox"){q.open=function(){var u,r,s,t;t=p.attr("data-bind");u=t.indexOf("width:")+7;r=t.indexOf(", height:");s=parseInt(t.substring(u,r),10)-25;p.css("width",s);p.dialog("option","position","{ my: 'center', at: 'center', of: window }")}}p.dialog(q);n=function(r){p.dialog(r?"open":"close")};o[m.openDialog].subscribe(n);e.utils.domNodeDisposal.addDisposeCallback(j,function(){p.dialog("destroy")})},options:{autoOpen:false,modal:true,resizable:false,draggable:false,show:"fade",hide:"fade",closeOnEscape:true,close:function(){},buttons:[{id:"btnOk",text:"Ok",click:function(){b(this).dialog("close")}},{id:"btnCancel",text:g.getDict("%cancel"),click:function(){b(this).dialog("close")}}],position:{my:"center",at:"center",collision:"fit"}}};e.bindingHandlers.uiAccordion={init:function(l,m){var k=m()||{},j=b("#"+k.refresh),i=b(l);if(typeof k.sortable!=="undefined"){i.accordion(k).sortable(k.sortable)}else{i.accordion(k)}if(typeof j!=="#undefined"){j.focus(function(){if(typeof i!=="undefined"){if(i.hasClass("ui-accordion")){i.accordion("refresh")}}})}e.utils.domNodeDisposal.addDisposeCallback(l,function(){i.accordion("destroy")})},update:function(k,l){var j=l()||{},i=b(k);if(typeof j.sortable!=="undefined"){i.accordion("destroy").accordion(j).sortable(j.sortable)}}};e.bindingHandlers.returnKey={init:function(k,l,m,j,i){e.utils.registerEventHandler(k,"keydown",function(n){if(n.keyCode===13){n.preventDefault();l().call(j,i.$data)}})}};e.extenders.numeric=function(k,j){var i=e.computed({read:k,write:function(l){var p,s,r=k(),q=j.precision,o=j.validation,t=Math.pow(10,q),m=isNaN(l)?o.min:parseFloat(+l),n=Math.round(m*t)/t;if(typeof l==="string"&&q>0){if(l.indexOf(".")===l.length-1){n=l}}if(typeof o!=="undefined"){p=(typeof o.min==="function")?o.min():o.min;s=(typeof o.max==="function")?o.max():o.max;if(n<p||n>s){b("#"+o.id).text(o.msg);n=p}else{b("#"+o.id).text("")}}if(n!==r){k(n)}else{if(l!==r){k.notifySubscribers(n)}}}}).extend({notify:"always"});i(k());return i}})}).call(this);